require 'rest-client'

{%~ if method in ['post', 'put', 'patch'] %}
payload = {{ sample_data|json_encode(constant('JSON_PRETTY_PRINT'))|raw }}

{% endif -%}

response = RestClient.{{ method }} '{{ base_url }}{{ uri }}',
{%~ if method in ['post', 'put', 'patch'] %}
    payload.to_json,
{% endif %}
    {
        'Content-Type' => 'application/json',
{% if security_enabled -%}
    {% if 'BearerToken' in security_schemes and 'BasicAuth' in security_schemes %}
        'Authorization' => 'Basic API_KEY:API_SECRET_KEY', # Or with Bearer eyJ0eXAiOiJKV1QiLCJ...
    {%~ elseif 'BearerToken' in security_schemes %}
        'Authorization' => 'Bearer eyJ0eXAiOiJKV1QiLCJ...',
    {%~ elseif 'BasicAuth' in security_schemes %}
        'Authorization' => 'Basic API_KEY:API_SECRET_KEY',
    {%~ endif -%}
{% endif %}
    }

puts response.body

URL url = new URL("{{ base_url }}{{ uri }}");

HttpURLConnection con = (HttpURLConnection) url.openConnection();
con.setRequestMethod("{{ method|upper }}");
con.setRequestProperty("Content-Type", "application/json;");
{% if security_enabled -%}
    {% if 'BearerToken' in security_schemes and 'BasicAuth' in security_schemes %}
con.setRequestProperty("Authorization", "Basic API_KEY:API_SECRET_KEY"); # Or with Bearer eyJ0eXAiOiJKV1QiLCJ...
    {%~ elseif 'BearerToken' in security_schemes %}
con.setRequestProperty("Authorization", "Bearer eyJ0eXAiOiJKV1QiLCJ...");
    {%~ elseif 'BasicAuth' in security_schemes %}
con.setRequestProperty("Authorization", "Basic API_KEY:API_SECRET_KEY");
    {%~ endif -%}
{% endif %}
con.setDoOutput(true);

{%~ if method in ['post', 'put', 'patch'] and sample_data is not empty %}
String jsonInputString = '{{ sample_data|json_encode(constant('JSON_PRETTY_PRINT'))|raw }}';
try (OutputStream os = con.getOutputStream()) {
    byte[] input = jsonInputString.getBytes("utf-8");
    os.write(input, 0, input.length);
}
{% endif -%}

BufferedReader in = new BufferedReader(new InputStreamReader(con.getInputStream(), "utf-8"));
StringBuilder response = new StringBuilder();
String responseLine;
while ((responseLine = in.readLine()) != null) {
    response.append(responseLine.trim());
}
in.close();
con.disconnect();

System.out.println(response.toString());

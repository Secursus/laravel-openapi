<?
{%~ if method in ['post', 'put', 'patch'] %}
$data = json_decode('{{ sample_data|json_encode(constant('JSON_PRETTY_PRINT'))|raw }}');

{% endif -%}

$ch = curl_init("{{ base_url }}{{ uri }}");

curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
{% if method == 'post' %}
curl_setopt($ch, CURLOPT_POST, true);
{% elseif method in ['put', 'patch', 'delete'] %}
curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "{{ method|upper }}");
{% endif %}
curl_setopt($ch, CURLOPT_HTTPHEADER, [
    'Content-Type: application/json',
{% if security_enabled -%}
    {% if 'BearerToken' in security_schemes and 'BasicAuth' in security_schemes %}
    'Authorization: Basic API_KEY:API_SECRET_KEY' // Or with Bearer eyJ0eXAiOiJKV1QiLCJ...
    {%~ elseif 'BearerToken' in security_schemes %}
    'Authorization: Bearer eyJ0eXAiOiJKV1QiLCJ...'
    {%~ elseif 'BasicAuth' in security_schemes %}
    'Authorization: Basic API_KEY:API_SECRET_KEY'
    {%~ endif -%}
{% endif %}
]);
{% if method in ['post', 'put', 'patch'] %}
curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($data));
{% endif %}

$response = curl_exec($ch);
curl_close($ch);
?>
